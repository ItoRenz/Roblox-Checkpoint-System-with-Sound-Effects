--[[
	Multiple Checkpoints System
	Author: ItoRenz00 + modification
	Description: Checkpoint hanya dengan efek suara,
                 nama bebas asalkan mengandung angka unik.
                 Efek suara hanya muncul sekali per checkpoint per respawn player.
	Place this script inside a Folder berisi part checkpoint.
--]]

local checkpointsFolder = script.Parent
local SOUND_ID = "rbxassetid://4757565956"
local SOUND_VOLUME = 0.5

local playerCheckpointTouched = {}

local function extractCheckpointNumber(name)
    local num = string.match(name, "%d+")
    if num then
        return tonumber(num)
    else
        return nil
    end
end

local function setupCheckpoint(checkpoint)
	if not checkpoint:IsA("BasePart") then
		warn("Object is not a BasePart:", checkpoint.Name)
		return
	end
	
	local sound = Instance.new("Sound")
	sound.SoundId = SOUND_ID
	sound.Volume = SOUND_VOLUME
	sound.Parent = checkpoint

	local function onTouch(hit)
		local humanoid = hit.Parent:FindFirstChild("Humanoid")
		if not humanoid then return end
		
		local player = game.Players:GetPlayerFromCharacter(hit.Parent)
		if not player then return end

		if not playerCheckpointTouched[player.UserId] then
			playerCheckpointTouched[player.UserId] = {}
		end

		local checkpointNumber = extractCheckpointNumber(checkpoint.Name)
		if not checkpointNumber then
			warn("Checkpoint part name must contain a unique number: " .. checkpoint.Name)
			return
		end

		if playerCheckpointTouched[player.UserId][checkpointNumber] then
			return
		end

		playerCheckpointTouched[player.UserId][checkpointNumber] = true

		sound:Play()
	end
	
	checkpoint.Touched:Connect(onTouch)
	print("Checkpoint setup complete:", checkpoint.Name)
end

game.Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function()
		playerCheckpointTouched[player.UserId] = {}
	end)
end)

for _, checkpoint in ipairs(checkpointsFolder:GetChildren()) do
	setupCheckpoint(checkpoint)
end

checkpointsFolder.ChildAdded:Connect(function(newCheckpoint)
	task.wait()
	setupCheckpoint(newCheckpoint)
end)

print("Multiple Checkpoints System ­– initialized successfully!")
print("Total checkpoints:", #checkpointsFolder:GetChildren())
